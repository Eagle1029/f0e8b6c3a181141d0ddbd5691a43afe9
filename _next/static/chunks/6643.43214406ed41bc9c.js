"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6643],{26643:function(e,t,n){n.r(t),n.d(t,{default:function(){return JackpotGame}});var a=n(85893),r=n(67294),l=n(94184),i=n.n(l),s=n(86501),d=n(37210),o=n(34816),c=n(43815),u=n(69316),m=n(25545),p=n(27982),h=n(54995),v=n.n(h),x=n(34558),f=n(33900),g=n(10990);let j=[{start:"#FF774D",end:"#FF774D"},{start:"#7C2EDF",end:"#7C2EDF"},{start:"#AB3AD7",end:"#AB3AD7"},{start:"#FFD552",end:"#FFA654"},{start:"#54ADFF",end:"#54ADFF"},{start:"#3656FF",end:"#3656FF"}];function JackpotGame(e){var t,n,l,h,y,w,k;let{className:A,data:F,setData:S,game:G,setGame:b,user:D,isAuthenticated:N,setGameWinner:T,...Y}=e,[_,R]=(0,r.useState)(0),[C,E]=(0,r.useState)(30),[I,P]=(0,r.useState)(),[z,U]=(0,r.useState)(!1),[Z,B]=(0,r.useState)(null),W=(0,r.useRef)(null),L=(0,r.useRef)({});(0,r.useEffect)(()=>{let fetchData=async()=>{try{let e=await (0,x.fo)(),t=[];e.current.players.map(e=>{t.push({name:e.username,value:e.betAmount,avatarUrl:e.avatar,_id:e._id})}),b(e),S(t),U(!0)}catch(e){s.Am.error("Failed to load the jackpot game, please refresh the page and try again!")}};return fetchData(),getAnimationSize(),window.addEventListener("resize",getAnimationSize),()=>{window.removeEventListener("resize",getAnimationSize)}},[]),(0,r.useEffect)(()=>{if(I){let e=L.current[I._id]-90+1440;g.p8.ticker.lagSmoothing(!1),g.p8.to(W.current,{rotation:e,duration:10,ease:"power2.out",onComplete:()=>{b(e=>(null==e?void 0:e.current)?{...e,current:{...e.current,status:3}}:e)}})}},[I]);let addPlayer=e=>{S(t=>[...t,{name:e.username,value:e.betAmount,avatarUrl:e.avatar,_id:e._id}])},countdownStarted=e=>{b(e=>(null==e?void 0:e.current)?{...e,current:{...e.current,status:2}}:e),E(e/1e3)},gameRolled=e=>{P(e.winner),null==T||T(e.winner),b(t=>(null==t?void 0:t.current)?{...t,current:{...t.current,publicSeed:e.publicSeed,privateSeed:e.privateSeed,status:4}}:t)},newRound=()=>{b(e=>(null==e?void 0:e.current)?{...e,current:{...e.current,status:1,players:[]}}:e),S([]),P(void 0),null==T||T(null),E(30),g.p8.ticker.lagSmoothing(!1),g.p8.set(W.current,{rotation:0})},percentagesUpdated=e=>{b(t=>t?{...t,current:{...t.current,players:e}}:t)},notify=e=>{B(e),setTimeout(()=>{B(null)},1e4)};(0,r.useEffect)(()=>(z&&(f.hY.on("new-player",addPlayer),f.hY.on("countdown-started",countdownStarted),f.hY.on("notify",notify),f.hY.on("game-rolled",gameRolled),f.hY.on("new-round",newRound),f.hY.on("percentages-updated",percentagesUpdated)),()=>{f.hY.off("new-player",addPlayer),f.hY.off("countdown-started",countdownStarted),f.hY.off("notify",notify),f.hY.on("game-rolled",gameRolled),f.hY.on("new-round",newRound),f.hY.on("percentages-updated",percentagesUpdated)}),[z]);let M=Math.PI/180;function getAnimationSize(){var e,t;R(null!==(t=null==W?void 0:null===(e=W.current)||void 0===e?void 0:e.clientWidth)&&void 0!==t?t:356)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{position:"relative"},className:i()(v().jackpotGame,A),...Y,children:(0,a.jsxs)("div",{className:v().jackpotGameInner,children:[(0,a.jsx)("div",{className:v().jackpotGamePointer}),(null==G?void 0:null===(t=G.current)||void 0===t?void 0:t.status)==1?(0,a.jsx)("div",{className:v().jackpotGameText,children:(0,a.jsx)(u.Z,{element:"p",textType:"regular16",children:"Waiting for players"})}):(null==G?void 0:null===(n=G.current)||void 0===n?void 0:n.status)==2?(0,a.jsxs)("div",{className:v().jackpotGameText,children:[(0,a.jsxs)("div",{className:v().jackpotGameTextTimer,children:["00:",C.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})]}),N&&(null==G?void 0:G.current.players.find(e=>e._id==D.robloxId))&&(0,a.jsxs)(u.Z,{element:"p",textType:"smHeadlines",className:v().jackpotGameTextCoeff,children:[null==G?void 0:null===(y=G.current)||void 0===y?void 0:null===(h=y.players)||void 0===h?void 0:null===(l=h.find(e=>e._id===D.robloxId))||void 0===l?void 0:l.winningPercentage.toFixed(2),"%"]}),N&&(null==G?void 0:G.current.players.find(e=>e._id==D.robloxId))&&(0,a.jsx)(u.Z,{element:"p",textType:"regular16",children:"Your win chance"})]}):(null==G?void 0:null===(w=G.current)||void 0===w?void 0:w.status)==3&&I?(0,a.jsxs)("div",{className:v().jackpotGameWinner,children:[(0,a.jsx)("div",{className:v().jackpotGameWinnerAvatar,children:(0,a.jsx)(m.Z,{style:{"--accent-color":"#AF3BD8",filter:"drop-shadow(0px 0px 20px #AB3AD7)"},className:i()("gamePlayersTableItemAvatar"),userId:I._id,imageAlt:"User avatar",boxSize:"extraLarge"})}),(0,a.jsxs)(p.Z,{element:"h2",children:[I.username," ",(0,a.jsx)("br",{})," won"]})]}):(null==G?void 0:null===(k=G.current)||void 0===k?void 0:k.status)==4?(0,a.jsx)("div",{className:v().jackpotGameText,children:(0,a.jsx)(u.Z,{element:"p",textType:"regular16",children:"Spinning"})}):void 0,(0,a.jsx)("div",{ref:W,className:v().jackpotGameChart,children:(0,a.jsxs)(d.u,{width:_,height:_,children:[(0,a.jsx)("defs",{children:F.map((e,t)=>(0,a.jsxs)("linearGradient",{y2:"100%",id:"myGradient".concat(t),children:[(0,a.jsx)("stop",{offset:"0%",stopColor:j[t%j.length].start}),(0,a.jsx)("stop",{offset:"100%",stopColor:j[t%j.length].end})]},t))}),(0,a.jsx)(o.b,{isAnimationActive:!1,labelLine:!1,stroke:"#282e54",strokeWidth:2,data:F,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:_/2-.17*_,outerRadius:_/2,fill:"#82ca9d",label:e=>{let{cx:t,cy:n,midAngle:r,innerRadius:l,outerRadius:i,percent:s,avatarUrl:d,_id:o}=e,c=l+(i-l)*.5;return L.current[o]=r,(0,a.jsxs)("svg",{style:{clipPath:"circle(50% at center)"},x:t+c*Math.cos(-r*M)-.045*_,y:n+c*Math.sin(-r*M)-.045*_,fill:"#39416D",textAnchor:"middle",dominantBaseline:"central",width:.09*_,height:.09*_,viewBox:"0 0 32 32",children:[(0,a.jsx)("circle",{r:.09*_/2,cx:.09*_/2,cy:.09*_/2,fill:"#39416D"}),(0,a.jsx)("image",{href:d,height:"100%",width:"100%"})]})},children:F.map((e,t)=>(0,a.jsx)(c.b,{fill:"url(#myGradient".concat(t,")")},"cell-".concat(t)))})]})})]})}),(0,a.jsx)("div",{className:v().jackpotGameWaitingMsg,children:Z&&(0,a.jsx)(u.Z,{element:"p",textType:"regular16",children:Z})})]})}}}]);